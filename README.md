# Stack-Based Virtual Machine and Assembler

This repository contains the implementation of a **stack-based virtual machine (VM)** and its corresponding **assembler**, developed as part of a systems concepts laboratory assignment.

The project includes:
- A custom assembler that converts assembly code into bytecode
- A virtual machine that executes the generated bytecode
- Sample assembly programs for testing and benchmarking
- A LaTeX report documenting the VM design and performance

---

## Project Structure

```

.
├── asm.c              # Assembler source code
├── vm.cpp             # Virtual Machine source code
├── fib.asm            # Fibonacci test program
├── factorial.asm      # Factorial test program
├── circle.asm         # Area of Circle test program
├── square.asm         # Square Function test program
├── compare.asm        # Benchmarking / comparison test
├── Makefile           # Build automation
├── program.bin        # Generated bytecode (output)
├── README.md          # Project documentation
└── report/            # LaTeX report files 

````

---

## Build Instructions

### Prerequisites
- GCC (for assembler)
- G++ (for VM)
- Make
- Linux / WSL environment recommended

### Clean and Build
```bash
make clean
make all
````

This generates:

* `asm` → assembler executable
* `vm` → virtual machine executable

---

## Running the Assembler

The assembler translates an assembly file into a binary program file.

### Syntax

```bash
./asm <input.asm> <output.bin>
```

### Example

```bash
./asm fib.asm program.bin
```

If successful, you will see:

```
Successfully assembled to program.bin
```

---

## Running the Virtual Machine

The virtual machine executes the generated bytecode.

### Syntax

```bash
./vm <program.bin> [iterations]
```

* `iterations` (optional): runs the program multiple times for benchmarking

### Example (normal execution)

```bash
./vm program.bin
```

Output:

```
Final Result: <value>
```

### Example (benchmarking mode)

```bash
./vm program.bin 10
```

Output:

```
Benchmarking 10 iterations...
Avg time: <time> us
Final Result: <value>
```

---

## Executing Provided Test Programs

### Fibonacci Program

```bash
./asm fib.asm program.bin
./vm program.bin
```

### Factorial Program

```bash
./asm factorial.asm program.bin
./vm program.bin
```

### Comparison / Benchmark Program

```bash
./asm compare.asm program.bin
./vm program.bin 10
```

---

## Notes

* The VM uses a **stack-based execution model**
* Function calls are handled using explicit **CALL** and **RET** instructions
* The return value of a program is left on top of the stack and printed as the final result
* Benchmarking uses repeated execution within the VM loop

---

## Limitations and Future Work

* Switch-based instruction dispatch limits performance
* No heap or dynamic memory allocation
* Minimal debugging and error diagnostics

Possible enhancements include:

* Threaded or JIT-based dispatch
* Heap support
* Better assembler error reporting
* Instruction-level profiling

---

## Author

Developed as part of a Systems Concepts laboratory assignment.
by-
Astitwa Saxena
2025MCS3005
Abhishek Gupta
2025MCS2963
